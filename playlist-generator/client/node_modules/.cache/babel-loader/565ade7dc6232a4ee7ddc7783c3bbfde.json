{"ast":null,"code":"var express = require(\"express\");\n\nvar logger = require(\"morgan\");\n\nvar mongoose = require(\"mongoose\"); // Our scraping tools\n// Axios is a promised-based http library, similar to jQuery's Ajax method\n// It works on the client and on the server\n// Require all models\n\n\nvar db = require(\"../models\");\n\nvar PORT = 3001; // Initialize Express\n\nvar app = express(); // Configure middleware\n// Use morgan logger for logging requests\n\napp.use(logger(\"dev\")); // Parse request body as JSON\n\napp.use(express.urlencoded({\n  extended: true\n}));\napp.use(express.json()); // Make public a static folder\n\napp.use(express.static(\"public\")); // Connect to the database before starting the application server.\n\nvar MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost/bandsintown';\nmongoose.connect(MONGODB_URI, {\n  useNewUrlParser: true\n});\nmongoose.connection.once('open', function () {\n  console.log('Database connection has been made');\n}).on('error', function (error) {\n  console.log('Database error:', error);\n});\n\nfunction getBandData() {\n  var cheerio = require(\"cheerio\");\n\n  var axios = require(\"axios\"); // First, tell the console what server.js is doing\n\n\n  console.log(\"\\n***********************************\\n\" + \"Grabbing Top 18 bands playing\\n\" + \"in 'this location':\" + \"\\n***********************************\\n\"); // Making a request via axios for reddit's \"webdev\" board. We are sure to use old.reddit due to changes in HTML structure for the new reddit. The page's Response is passed as our promise argument.\n  //axios.get(\"https://www.bandsintown.com/?place_id=ChIJzWXFYYuifDUR64Pq5LTtioU&sort_by_filter=Number+of+RSVPs\").then(function(response) {\n\n  var BASEURL = \"https://www.bandsintown.com/?latitude=\";\n  var LAT = \"36.16\";\n  var LON = \"-86.77\";\n  var SORT = \"&sort_by_filter=Number+of+RSVPs\";\n  var url = BASEURL + LAT + \"&\" + LON + SORT;\n  axios.get(url).then(function (response) {\n    // Load the Response into cheerio and save it to a variable\n    // '$' becomes a shorthand for cheerio's selector commands, much like jQuery's '$'\n    var $ = cheerio.load(response.data); // An empty array to  save the data that we'll scrape\n\n    var results = []; // With cheerio, find each p-tag with the \"title\" class\n    // (i: iterator. element: the current element)\n\n    $(\"div.upcomingEvents-075e0336\").each(function (i, element) {\n      // Save the text of the element in a \"title\" variable\n      //var title = $(element).text();\n      //let eventsNear = $(element).find(\"h1\").text();\n      $(element).find(\"h2.event-5daafce9\").each(function (i, element) {\n        var bandName = $(element).text(); // In the currently selected element, look at its child elements (i.e., its a-tags),\n        // then save the values for any \"href\" attributes that the child elements may have\n        // Save these results in an object that we'll push into the results array we defined earlier\n\n        results.push({\n          //title: title,\n          //City: eventsNear,\n          bandName: bandName\n        });\n      });\n      db.Band.deleteMany({}, function (err) {});\n      db.Band.create(results).then(function (dbBands) {\n        console.log(\"********************************************\\n\" + \"These bands have been added to the database\\n\" + \"and the old content has been removed.\" + \"\\n********************************************\");\n      }).catch(function (err) {\n        console.log(err);\n      });\n    });\n    app.get(\"/bands\", function (req, res) {\n      db.Band.find([]).then(function (dbBands) {\n        res.json(dbBands);\n      }).catch(function (err) {\n        res.json(err);\n      });\n    }); // Log the results once you've looped through each of the elements found with cheerio\n\n    console.log(\"These are the results from getBandData:\\n\", results);\n  });\n} // Start the server\n\n\napp.listen(PORT, function () {\n  console.log(\"App running on port \" + PORT + \"!\");\n});\ngetBandData();\nmodule.exports = getBandData;","map":{"version":3,"sources":["/Users/kevinmiller/VBC/homework/playlist-generator/client/src/components/scraper.js"],"names":["express","require","logger","mongoose","db","PORT","app","use","urlencoded","extended","json","static","MONGODB_URI","process","env","connect","useNewUrlParser","connection","once","console","log","on","error","getBandData","cheerio","axios","BASEURL","LAT","LON","SORT","url","get","then","response","$","load","data","results","each","i","element","find","bandName","text","push","Band","deleteMany","err","create","dbBands","catch","req","res","listen","module","exports"],"mappings":"AAAA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIE,QAAQ,GAAGF,OAAO,CAAC,UAAD,CAAtB,C,CAEA;AACA;AACA;AAEI;;;AACA,IAAIG,EAAE,GAAGH,OAAO,CAAC,WAAD,CAAhB;;AAGJ,IAAII,IAAI,GAAG,IAAX,C,CAEA;;AACA,IAAIC,GAAG,GAAGN,OAAO,EAAjB,C,CAEA;AAEA;;AACAM,GAAG,CAACC,GAAJ,CAAQL,MAAM,CAAC,KAAD,CAAd,E,CACA;;AACAI,GAAG,CAACC,GAAJ,CAAQP,OAAO,CAACQ,UAAR,CAAmB;AACvBC,EAAAA,QAAQ,EAAE;AADa,CAAnB,CAAR;AAGAH,GAAG,CAACC,GAAJ,CAAQP,OAAO,CAACU,IAAR,EAAR,E,CACA;;AACAJ,GAAG,CAACC,GAAJ,CAAQP,OAAO,CAACW,MAAR,CAAe,QAAf,CAAR,E,CAGA;;AACA,IAAMC,WAAW,GAAGC,OAAO,CAACC,GAAR,CAAYF,WAAZ,IAA2B,iCAA/C;AACAT,QAAQ,CAACY,OAAT,CAAiBH,WAAjB,EAA8B;AAC1BI,EAAAA,eAAe,EAAE;AADS,CAA9B;AAKAb,QAAQ,CAACc,UAAT,CAAoBC,IAApB,CAAyB,MAAzB,EAAiC,YAAY;AACzCC,EAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ;AACH,CAFD,EAEGC,EAFH,CAEM,OAFN,EAEe,UAAUC,KAAV,EAAiB;AAC5BH,EAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BE,KAA/B;AACH,CAJD;;AAOA,SAASC,WAAT,GAAuB;AACnB,MAAIC,OAAO,GAAGvB,OAAO,CAAC,SAAD,CAArB;;AACA,MAAIwB,KAAK,GAAGxB,OAAO,CAAC,OAAD,CAAnB,CAFmB,CAKnB;;;AACAkB,EAAAA,OAAO,CAACC,GAAR,CAAY,4CACR,iCADQ,GAER,qBAFQ,GAGR,yCAHJ,EANmB,CAWnB;AACA;;AACA,MAAMM,OAAO,GAAG,wCAAhB;AACA,MAAIC,GAAG,GAAG,OAAV;AACA,MAAIC,GAAG,GAAG,QAAV;AACA,MAAMC,IAAI,GAAG,iCAAb;AACA,MAAMC,GAAG,GAAGJ,OAAO,GAAGC,GAAV,GAAgB,GAAhB,GAAsBC,GAAtB,GAA4BC,IAAxC;AAGAJ,EAAAA,KAAK,CAACM,GAAN,CAAUD,GAAV,EACKE,IADL,CACU,UAAUC,QAAV,EAAoB;AAItB;AACA;AACA,QAAIC,CAAC,GAAGV,OAAO,CAACW,IAAR,CAAaF,QAAQ,CAACG,IAAtB,CAAR,CANsB,CAQtB;;AACA,QAAIC,OAAO,GAAG,EAAd,CATsB,CAWtB;AACA;;AACAH,IAAAA,CAAC,CAAC,6BAAD,CAAD,CAAiCI,IAAjC,CAAsC,UAAUC,CAAV,EAAaC,OAAb,EAAsB;AAExD;AACA;AAEA;AAEAN,MAAAA,CAAC,CAACM,OAAD,CAAD,CAAWC,IAAX,CAAgB,mBAAhB,EAAqCH,IAArC,CAA0C,UAAUC,CAAV,EAAaC,OAAb,EAAsB;AAC5D,YAAIE,QAAQ,GAAGR,CAAC,CAACM,OAAD,CAAD,CAAWG,IAAX,EAAf,CAD4D,CAI5D;AACA;AAEA;;AACAN,QAAAA,OAAO,CAACO,IAAR,CAAa;AACT;AACA;AACAF,UAAAA,QAAQ,EAAEA;AAHD,SAAb;AAKH,OAbD;AAeAtC,MAAAA,EAAE,CAACyC,IAAH,CAAQC,UAAR,CAAmB,EAAnB,EAAuB,UAASC,GAAT,EAAc,CACnC,CADF;AAGA3C,MAAAA,EAAE,CAACyC,IAAH,CAAQG,MAAR,CAAeX,OAAf,EACKL,IADL,CACU,UAAUiB,OAAV,EAAmB;AACrB9B,QAAAA,OAAO,CAACC,GAAR,CAAY,mDACA,+CADA,GAEA,uCAFA,GAGF,gDAHV;AAIH,OANL,EAOK8B,KAPL,CAOW,UAAUH,GAAV,EAAe;AAClB5B,QAAAA,OAAO,CAACC,GAAR,CAAY2B,GAAZ;AACH,OATL;AAUH,KAnCD;AAqCAzC,IAAAA,GAAG,CAACyB,GAAJ,CAAQ,QAAR,EAAkB,UAAUoB,GAAV,EAAeC,GAAf,EAAoB;AAClChD,MAAAA,EAAE,CAACyC,IAAH,CAAQJ,IAAR,CAAa,EAAb,EACKT,IADL,CACU,UAAUiB,OAAV,EAAmB;AACrBG,QAAAA,GAAG,CAAC1C,IAAJ,CAASuC,OAAT;AACH,OAHL,EAIKC,KAJL,CAIW,UAAUH,GAAV,EAAe;AAClBK,QAAAA,GAAG,CAAC1C,IAAJ,CAASqC,GAAT;AACH,OANL;AAOH,KARD,EAlDsB,CA4DtB;;AACA5B,IAAAA,OAAO,CAACC,GAAR,CAAY,2CAAZ,EAAyDiB,OAAzD;AACH,GA/DL;AAgEH,C,CAED;;;AACA/B,GAAG,CAAC+C,MAAJ,CAAWhD,IAAX,EAAiB,YAAY;AACzBc,EAAAA,OAAO,CAACC,GAAR,CAAY,yBAAyBf,IAAzB,GAAgC,GAA5C;AACH,CAFD;AAIAkB,WAAW;AAEX+B,MAAM,CAACC,OAAP,GAAiBhC,WAAjB","sourcesContent":["var express = require(\"express\");\nvar logger = require(\"morgan\");\nvar mongoose = require(\"mongoose\");\n\n// Our scraping tools\n// Axios is a promised-based http library, similar to jQuery's Ajax method\n// It works on the client and on the server\n\n    // Require all models\n    var db = require(\"../models\");\n\n\nvar PORT = 3001;\n\n// Initialize Express\nvar app = express();\n\n// Configure middleware\n\n// Use morgan logger for logging requests\napp.use(logger(\"dev\"));\n// Parse request body as JSON\napp.use(express.urlencoded({\n    extended: true\n}));\napp.use(express.json());\n// Make public a static folder\napp.use(express.static(\"public\"));\n\n\n// Connect to the database before starting the application server.\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost/bandsintown';\nmongoose.connect(MONGODB_URI, {\n    useNewUrlParser: true\n});\n\n\nmongoose.connection.once('open', function () {\n    console.log('Database connection has been made');\n}).on('error', function (error) {\n    console.log('Database error:', error);\n});\n\n\nfunction getBandData() {\n    var cheerio = require(\"cheerio\");\n    var axios = require(\"axios\");\n\n\n    // First, tell the console what server.js is doing\n    console.log(\"\\n***********************************\\n\" +\n        \"Grabbing Top 18 bands playing\\n\" +\n        \"in 'this location':\" +\n        \"\\n***********************************\\n\");\n\n    // Making a request via axios for reddit's \"webdev\" board. We are sure to use old.reddit due to changes in HTML structure for the new reddit. The page's Response is passed as our promise argument.\n    //axios.get(\"https://www.bandsintown.com/?place_id=ChIJzWXFYYuifDUR64Pq5LTtioU&sort_by_filter=Number+of+RSVPs\").then(function(response) {\n    const BASEURL = \"https://www.bandsintown.com/?latitude=\";\n    let LAT = \"36.16\";\n    let LON = \"-86.77\";\n    const SORT = \"&sort_by_filter=Number+of+RSVPs\";\n    const url = BASEURL + LAT + \"&\" + LON + SORT;\n\n\n    axios.get(url)\n        .then(function (response) {\n\n\n\n            // Load the Response into cheerio and save it to a variable\n            // '$' becomes a shorthand for cheerio's selector commands, much like jQuery's '$'\n            var $ = cheerio.load(response.data);\n\n            // An empty array to  save the data that we'll scrape\n            var results = [];\n\n            // With cheerio, find each p-tag with the \"title\" class\n            // (i: iterator. element: the current element)\n            $(\"div.upcomingEvents-075e0336\").each(function (i, element) {\n\n                // Save the text of the element in a \"title\" variable\n                //var title = $(element).text();\n\n                //let eventsNear = $(element).find(\"h1\").text();\n\n                $(element).find(\"h2.event-5daafce9\").each(function (i, element) {\n                    let bandName = $(element).text()\n\n\n                    // In the currently selected element, look at its child elements (i.e., its a-tags),\n                    // then save the values for any \"href\" attributes that the child elements may have\n\n                    // Save these results in an object that we'll push into the results array we defined earlier\n                    results.push({\n                        //title: title,\n                        //City: eventsNear,\n                        bandName: bandName\n                    });\n                });\n\n                db.Band.deleteMany({}, function(err) { \n                 });\n\n                db.Band.create(results)\n                    .then(function (dbBands) {\n                        console.log(\"********************************************\\n\"+\n                                    \"These bands have been added to the database\\n\"+\n                                    \"and the old content has been removed.\"+\n                                  \"\\n********************************************\");\n                    })\n                    .catch(function (err) {\n                        console.log(err);\n                    });\n            });\n\n            app.get(\"/bands\", function (req, res) {\n                db.Band.find([])\n                    .then(function (dbBands) {\n                        res.json(dbBands);\n                    })\n                    .catch(function (err) {\n                        res.json(err);\n                    });\n            });\n\n            // Log the results once you've looped through each of the elements found with cheerio\n            console.log(\"These are the results from getBandData:\\n\", results);\n        });\n}\n\n// Start the server\napp.listen(PORT, function () {\n    console.log(\"App running on port \" + PORT + \"!\");\n});\n\ngetBandData()\n\nmodule.exports = getBandData"]},"metadata":{},"sourceType":"module"}